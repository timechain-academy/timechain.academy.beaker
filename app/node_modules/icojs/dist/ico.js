/*!
 * icojs v0.12.3
 * (c) egy186
 * https://github.com/egy186/icojs/blob/master/LICENSE
 */
!function(t,e){var r,n;"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self,r=t.ICO,(n=t.ICO=e()).noConflict=function(){return t.ICO=r,n})}(this,function(){"use strict";function t(t,e){return t(e={exports:{}},e.exports),e.exports}var e={MIME_BMP:"image/bmp",MIME_JPEG:"image/jpeg",MIME_PNG:"image/png"},r=e.MIME_BMP,n=e.MIME_JPEG,i=e.MIME_PNG,o=Object.freeze({default:e,__moduleExports:e,MIME_BMP:r,MIME_JPEG:n,MIME_PNG:i}),a=o&&e||o,f=t(function(t){var e=a.MIME_PNG,r={decode:function(e){return new Promise(function(o){var t=URL.createObjectURL(new Blob([e])),a=document.createElement("img");a.src=t,a.onload=function(){var t=a.naturalHeight,e=a.naturalWidth,r=document.createElement("canvas");r.width=e,r.height=t;var n=r.getContext("2d");n.drawImage(a,0,0);var i=n.getImageData(0,0,e,t).data;o({data:i,height:t,width:e})}})},encode:function(u){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:e;return new Promise(function(t){var e=u.data,r=u.height,n=u.width,i=document.createElement("canvas");i.width=n,i.height=r;for(var o=i.getContext("2d"),a=o.createImageData(n,r),f=a.data,h=0;h<f.length;h++)f[h]=e[h];o.putImageData(a,0,0),t(function(t){for(var e=atob(t.replace(/(?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+,/,"")),r=new Uint8Array(e.length),n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return r.buffer}(i.toDataURL(c)))})}};t.exports=r}),h=Object.freeze({default:f,__moduleExports:f}),u=function(t){if(t instanceof Uint8Array)return new DataView(t.buffer,t.byteOffset,t.byteLength);if(t instanceof ArrayBuffer)return new DataView(t);throw new TypeError("Expected `data` to be an ArrayBuffer or Uint8Array")},c=Object.freeze({default:u,__moduleExports:u}),v=c&&u||c,d=t(function(t){t.exports=function(t){var e=v(t);return 0===e.getUint16(0,!0)&&1===e.getUint16(2,!0)}}),s=Object.freeze({default:d,__moduleExports:d});function g(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var m=function(){function u(t,e,r){var n,i,o=r.width,a=r.height,f=r.colorDepth,h=r.format;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),this.format=h,this.offset=e,this.depth=f,this.stride=(n=o*this.depth/8,(i=n%4)?n+4-i:n),this.size=this.stride*a,this.data=t.slice(this.offset,this.offset+this.size),this.size!==this.data.byteLength)throw new Error("Truncated bitmap data")}var t,e,r;return t=u,(e=[{key:"get",value:function(t,e,r){var n=this.format.indexOf(r);return 1===this.depth?(this.data[e*this.stride+(t/8|0)]&1<<7-t%8*1)>>7-t%8*1:2===this.depth?(this.data[e*this.stride+(t/4|0)]&3<<6-t%4*2)>>>6-t%4*2:4!==this.depth?this.data[e*this.stride+t*(this.depth/8)+n]:(this.data[e*this.stride+(t/2|0)]&15<<4-t%2*4)>>>4-t%2*4}}])&&g(t.prototype,e),r&&g(t,r),u}();var l=function(t){var e,r,n,i,o,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},f=a.width,h=void 0===f?0:f,u=a.height,c=void 0===u?0:u,d=a.icon,s=void 0!==d&&d,g=v(t);0===(o=s?(e=g.getUint32(0,!0),r=g.getUint32(4,!0)/1|0,n=g.getUint32(8,!0)/2|0,i=g.getUint16(14,!0),g.getUint32(32,!0)):(function(t){if(19778!==t)throw new Error("Invalid magic byte 0x".concat(t.toString(16)))}(g.getUint16(0,!0)),e=14+g.getUint32(14,!0),r=g.getUint32(18,!0),n=g.getUint32(22,!0),i=g.getUint16(28,!0),g.getUint32(46,!0)))&&i<=8&&(o=1<<i);var l=0===r?h:r,p=0===n?c:n,w=new Uint8Array(g.buffer,g.byteOffset+e,g.byteLength-e);return{width:l,height:p,data:o?function(t,e){var r=e.width,n=e.height,i=e.colorDepth,o=e.colorCount,a=e.icon;if(8!==i&&4!==i&&2!==i&&1!==i)throw new Error("A color depth of ".concat(i," is not supported"));for(var f=new m(t,0,{width:o,height:1,colorDepth:32,format:"BGRA"}),h=new m(t,f.offset+f.size,{width:r,height:n,colorDepth:i,format:"C"}),u=a?new m(t,h.offset+h.size,{width:r,height:n,colorDepth:1,format:"A"}):null,c=new Uint8Array(r*n*4),d=0,s=0;s<n;s++)for(var g=0;g<r;g++){var l=h.get(g,n-s-1,"C");c[d++]=f.get(l,0,"R"),c[d++]=f.get(l,0,"G"),c[d++]=f.get(l,0,"B"),c[d++]=u&&u.get(g,n-s-1,"A")?0:255}return c}(w,{width:l,height:p,colorDepth:i,colorCount:o,icon:s}):function(t,e){var r=e.width,n=e.height,i=e.colorDepth,o=e.icon;if(32!==i&&24!==i)throw new Error("A color depth of ".concat(i," is not supported"));for(var a=new m(t,0,{width:r,height:n,colorDepth:i,format:"BGRA"}),f=24===i&&o?new m(t,a.offset+a.size,{width:r,height:n,colorDepth:1,format:"A"}):null,h=new Uint8Array(r*n*4),u=0,c=0;c<n;c++)for(var d=0;d<r;d++)h[u++]=a.get(d,n-c-1,"R"),h[u++]=a.get(d,n-c-1,"G"),h[u++]=a.get(d,n-c-1,"B"),h[u++]=32===i?a.get(d,n-c-1,"A"):f&&f.get(d,n-c-1,"A")?0:255;return h}(w,{width:l,height:p,colorDepth:i,icon:s}),colorDepth:i}},p=Object.freeze({default:l,__moduleExports:l}),b=p&&l||p;var w=function(t){var p=v(t);if(p.byteLength<6)throw new Error("Truncated header");if(0!==p.getUint16(0,!0))throw new Error("Invalid magic bytes");var w=p.getUint16(2,!0);if(1!==w&&2!==w)throw new Error("Invalid image type");var e=p.getUint16(4,!0);if(p.byteLength<6+16*e)throw new Error("Truncated image list");return Array.from({length:e},function(t,e){var r,n,i,o,a,f,h=p.getUint8(6+16*e+0),u=p.getUint8(6+16*e+1),c=p.getUint32(6+16*e+8,!0),d=p.getUint32(6+16*e+12,!0),s=2!==w?null:{x:p.getUint16(6+16*e+4,!0),y:p.getUint16(6+16*e+6,!0)};if(f=d,2303741511===(a=p).getUint32(f+0)&&218765834===a.getUint32(f+4))return{bpp:function(t,e){var r=t.getUint8(e+24),n=t.getUint8(e+25);if(0===n)return 1*r;if(2===n)return 3*r;if(3===n)return 1*r;if(4===n)return 2*r;if(6===n)return 4*r;throw new Error("Invalid PNG colorType")}(p,d),data:new Uint8Array(p.buffer,p.byteOffset+d,c),height:(i=p,o=d,i.getUint32(o+20,!1)),hotspot:s,type:"png",width:(r=p,n=d,r.getUint32(n+16,!1))};var g=new Uint8Array(p.buffer,p.byteOffset+d,c),l=b(g,{width:h,height:u,icon:!0});return{bpp:l.colorDepth,data:l.data,height:l.height,hotspot:s,type:"bmp",width:l.width}})},y=Object.freeze({default:w,__moduleExports:w}),E=y&&w||y,U=t(function(t){var o=a.MIME_PNG;t.exports=function(t,r,n){var e=null;try{e=E(t)}catch(t){return Promise.reject(t)}var i=function(e){return n.encode(e,r).then(function(t){return Object.assign(e,{buffer:t,type:r.replace("image/","")})})};return Promise.all(e.map(function(t){return r===o&&"png"===t.type?Promise.resolve(Object.assign({buffer:t.data.buffer.slice(t.data.byteOffset,t.data.byteOffset+t.data.byteLength)},t)):(e=t,"png"!==e.type?Promise.resolve(e):n.decode(e.data).then(function(t){return Object.assign(e,{data:t.data,type:"bmp"})})).then(i);var e}))}}),D=Object.freeze({default:U,__moduleExports:U}),M=h&&f||h,_=s&&d||s,I=D&&U||D,x=a.MIME_PNG;return{isICO:_,parse:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:x;return I(t,e,M)}}});
//# sourceMappingURL=ico.js.map
